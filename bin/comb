#!/usr/bin/python

import os, sys
import comb.combd
import importlib


def useage():
    print "Useage", os.path.basename(sys.argv[0]), ''' [--root packages-root]  slot-package.slot-module

    slot-package.slot-module        same as python package.module.@note:this must be last argument.

    Global:
    --root                          find package.module in root path,it will search SLOTPATH first
    --debug                         open debug flag

    More:
    You can view https://github.com/kbonez/comb/blob/master/README.md 'How to use comb' to get more info.

    '''


if '-h' in sys.argv or '--help' in sys.argv:
    useage()
    sys.exit(0)

_debug = False
if '--debug' in sys.argv:
    _debug = True


runtime_path=user_path=None

root_pos = -1
try:
    root_pos = sys.argv.index('--root')
    runtime_path = sys.argv[root_pos+1] if root_pos+1 < sys.argv.__len__()-1 else None

    # @todo set python path
    # print os.getenv('SLOTPATH')
    # sys.exit(1)
    sys.path.append(os.path.realpath(runtime_path))


except:
    pass




module_name = sys.argv[-1]

if sys.argv.__len__() < 2 or module_name[:1] == '-' or root_pos+1 == sys.argv.__len__()-1:
    print "illegal option,use -h to get help."
    sys.exit(0)



if _debug:
    current_module = importlib.import_module(module_name)
else:
    try:
        current_module = importlib.import_module(module_name)
    except:
        print "load slot-module `",module_name,"`,fail, you can set --debug option to check it.@Note:make sure slot-module is last argument."
        sys.exit(-1)



if __name__ == '__main__':
    comb.combd.Start(current_module.Slot, **{'debug': _debug})










